<div id="form_errors">
  <div class="alert-custom">Start Date must be before End Date</div>
</div>

<div id="form_errors1">
  <div class="alert-custom">Please choose start and end date</div>
</div>

<h1 class="page-header">
  <%= @user.first_name %> <%= @user.last_name %> (<%= @user.username %>)
</h1>

<h2>Request Booking</h2>

<%= form_for :booking, url: { action: 'new', controller: 'booking' }, html: { id: 'booking_form' } do |f| %>
    <div class="form-group">
      <%= f.text_field :start_date, placeholder: 'Start Date', size: '20', required: true, id: 'start_date', class: 'form-control' %>
    </div>

    <div class="form-group">
      <%= f.text_field :end_date, placeholder: 'End Date', size: '20', required: true, id: 'end_date', class: 'form-control' %>
    </div>

    <div class="form-group">
      <%= f.text_field :provider_id, type: 'hidden', value: @user.id %>
    </div>

    <%= f.button 'Request Booking', class: 'btn btn-primary', type: 'button', onclick: 'validate();' %>
<% end %>

<h3>Per day cost</h3>
$ <%= @user.per_day_price %><br>

<% if Favourite.find_by(cust_id: current_user.id, provider_id: @user.id) %>
    <% attr = 'danger' %>
    <% val = 'Unfavourite' %>
<% else %>
    <% attr = 'primary' %>
    <% val = 'Favourite' %>
<% end %>
<button class="btn btn-<%=attr%>" id="favourite" onclick="favourite(<%= @user.id %>)"><%=val%></button>

<script>

  Date.prototype.addDays = function(days) {
    var dat = new Date(this.valueOf());
    dat.setDate(dat.getDate() + days);
    return dat;
  }

  var dates = [];

  <% @bookings.each do |book| %>
  var startDate = new Date("<%= book.start_date %>");
  var endDate = new Date("<%= book.end_date %>");
  while(startDate <= endDate) {
    dates.push(jQuery.datepicker.formatDate('yy-mm-dd',startDate));
    startDate = startDate.addDays(1);
  }
  <% end %>

  //console.log(dates);

  function DisableSpecificDates(date) {
    var string = jQuery.datepicker.formatDate('yy-mm-dd', date);
    //console.log(string);
    if ($.inArray(string, dates) == -1) {
      //console.log(string);
      return [true];
    }
    else {
      //console.log(string);
      return [false];
    }

  }

  $(function() {
    if($('#start_date').length) {
      $("#start_date").datepicker({ minDate: 0, dateFormat: 'yy-mm-dd', beforeShowDay: DisableSpecificDates});
      $("#end_date").datepicker({ minDate: 0, dateFormat: 'yy-mm-dd', beforeShowDay: DisableSpecificDates});
    }
  });
</script>
